<mat-card class="overflow-hidden bg-white rounded-2xl shadow-lg border border-gray-200/80 transition-all">
  <!-- Encabezado -->
  <div class="bg-gradient-to-br from-orange-500 to-amber-500 px-0 py-4 text-center text-white border-b border-orange-200/60">
    <div class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center mx-auto mb-2 shadow-inner backdrop-blur-sm">
      <img src="/logos/logos.png" alt="MichiBurgers" class="w-10 h-10 object-contain" />
    </div>
    <h2 class="text-2xl font-bold mb-1 tracking-tight">Recuperar contraseña</h2>
    <p class="text-orange-100 text-sm">Validaremos tus datos para asignar una nueva contraseña</p>
    <button type="button" (click)="close()" class="absolute right-3 top-3 text-white/90 hover:text-white focus:outline-none" aria-label="Cerrar">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Contenido -->
  <div class="px-0 py-3 bg-white">
    <form [formGroup]="form" (ngSubmit)="submit()" class="max-w-md grid gap-2">
      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Legajo</mat-label>
        <input matInput formControlName="legajo" placeholder="Tu legajo" autofocus aria-label="Legajo" />
        <mat-hint class="!text-xs text-neutral-500">Identificador interno</mat-hint>
        <mat-error *ngIf="form.get('legajo')?.hasError('required')">Requerido</mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="w-full">
        <mat-label>DNI</mat-label>
        <input matInput formControlName="dni" placeholder="Tu DNI" />
        <mat-hint class="!text-xs text-neutral-500">Solo números, sin puntos</mat-hint>
        <mat-error *ngIf="form.get('dni')?.hasError('required')">Requerido</mat-error>
        <mat-error *ngIf="form.get('dni')?.hasError('minlength')">Mínimo 6 caracteres</mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Nueva contraseña</mat-label>
        <input matInput [type]="hideNext ? 'password' : 'text'" formControlName="next" autocomplete="new-password" placeholder="••••••"
               (keydown)="onPassKey('next', $event)" (keyup)="onPassKey('next', $event)" (blur)="onPassBlur('next')" aria-label="Nueva contraseña" />
        <button mat-icon-button type="button" matSuffix (click)="hideNext = !hideNext" [attr.aria-label]="hideNext ? 'Mostrar contraseña' : 'Ocultar contraseña'">
          <mat-icon>{{ hideNext ? 'visibility' : 'visibility_off' }}</mat-icon>
        </button>
        <mat-hint class="!text-xs text-neutral-500">Mínimo 6 caracteres</mat-hint>
        <mat-error *ngIf="form.get('next')?.hasError('required')">Requerida</mat-error>
        <mat-error *ngIf="form.get('next')?.hasError('minlength')">Mínimo 6 caracteres</mat-error>
      </mat-form-field>

      <div class="text-xs text-gray-600 -mt-2 mb-2 flex items-center gap-2">
        <mat-icon class="!text-base text-orange-500">info</mat-icon>
        Usá al menos 6 caracteres. Evitá datos personales.
      </div>

      <mat-form-field appearance="fill" class="w-full">
        <mat-label>Confirmar nueva contraseña</mat-label>
        <input matInput [type]="hideConfirm ? 'password' : 'text'" formControlName="confirm" autocomplete="new-password" placeholder="Repetí la contraseña"
               (keydown)="onPassKey('confirm', $event)" (keyup)="onPassKey('confirm', $event)" (blur)="onPassBlur('confirm')" aria-label="Confirmar nueva contraseña" />
        <button mat-icon-button type="button" matSuffix (click)="hideConfirm = !hideConfirm" [attr.aria-label]="hideConfirm ? 'Mostrar contraseña' : 'Ocultar contraseña'">
          <mat-icon>{{ hideConfirm ? 'visibility' : 'visibility_off' }}</mat-icon>
        </button>
        <mat-error *ngIf="form.get('confirm')?.hasError('required')">Requerido</mat-error>
      </mat-form-field>

      <div *ngIf="capsNext || capsConfirm" class="-mt-2 text-xs text-orange-600 flex items-center gap-1" aria-live="polite">
        <mat-icon class="!text-base text-orange-500">keyboard_capslock</mat-icon>
        Mayúsculas activadas
      </div>

      <button mat-raised-button color="primary" type="submit" [disabled]="loading" class="w-full bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white font-semibold py-3.5 px-6 rounded-xl shadow-md disabled:shadow-none transition-colors duration-200 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-base">
        {{ loading ? 'Procesando…' : 'Recuperar' }}
      </button>

      <div *ngIf="error" class="bg-red-50 border border-red-200 text-red-700 text-sm rounded-xl px-3 py-2">
        {{ error }}
      </div>
      <div *ngIf="ok" class="bg-green-50 border border-green-200 text-green-700 text-sm rounded-xl px-3 py-2">
        ¡Contraseña actualizada! Ya podés iniciar sesión.
      </div>
    </form>
  </div>
</mat-card>
