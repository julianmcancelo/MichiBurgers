<mat-card
  class="overflow-hidden bg-white rounded-2xl shadow-lg border border-gray-200/80 transition-all"
>
  <!-- Encabezado -->
  <div
    class="bg-gradient-to-br from-orange-500 to-amber-500 px-0 py-4 text-center text-white border-b border-orange-200/60 relative"
  >
    <div
      class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center mx-auto mb-2 shadow-inner backdrop-blur-sm"
    >
      <img src="/logos/logos.png" alt="MichiBurgers" class="w-10 h-10 object-contain" />
    </div>
    <h2 class="text-2xl font-bold mb-1 tracking-tight">Cambiar contraseña</h2>
    <p class="text-orange-100 text-sm">Actualizá tu contraseña de acceso</p>
    <button
      type="button"
      (click)="close()"
      aria-label="Cerrar"
      class="absolute right-3 top-3 text-white/90 hover:text-white focus:outline-none"
    >
      <span
        class="inline-flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 transition-colors p-1 focus-visible:ring-2 focus-visible:ring-white/70"
      >
        <mat-icon class="!text-base">close</mat-icon>
      </span>
    </button>
  </div>

  <!-- Contenido -->
  <div class="px-0 py-3 bg-white">
    <form [formGroup]="form" (ngSubmit)="submit()" class="max-w-md grid gap-1.5">
      <mat-form-field appearance="fill" class="mb-1.5">
        <mat-label>Contraseña actual</mat-label>
        <mat-icon matPrefix class="!text-gray-400 !text-base mr-1">lock</mat-icon>
        <input
          matInput
          [type]="hideCurrent ? 'password' : 'text'"
          formControlName="current"
          autocomplete="current-password"
          placeholder="••••"
          autofocus
          aria-label="Contraseña actual"
          (keydown)="onPassKey('current', $event)"
          (keyup)="onPassKey('current', $event)"
          (blur)="onPassBlur('current')"
        />
        <button
          mat-icon-button
          type="button"
          matSuffix
          (click)="hideCurrent = !hideCurrent"
          [attr.aria-label]="hideCurrent ? 'Mostrar contraseña' : 'Ocultar contraseña'"
          class="!h-7 !w-7"
        >
          <mat-icon class="!text-base">{{
            hideCurrent ? 'visibility' : 'visibility_off'
          }}</mat-icon>
        </button>
        <mat-hint class="!text-xs text-neutral-500">Mínimo 4 caracteres</mat-hint>
        <mat-error *ngIf="form.get('current')?.hasError('required')">Requerida</mat-error>
        <mat-error *ngIf="form.get('current')?.hasError('minlength')"
          >Mínimo 4 caracteres</mat-error
        >
      </mat-form-field>

      <mat-form-field appearance="fill" class="mb-1.5">
        <mat-label>Nueva contraseña</mat-label>
        <mat-icon matPrefix class="!text-gray-400 !text-base mr-1">lock_reset</mat-icon>
        <input
          matInput
          [type]="hideNext ? 'password' : 'text'"
          formControlName="next"
          autocomplete="new-password"
          placeholder="••••••"
          (keydown)="onPassKey('next', $event)"
          (keyup)="onPassKey('next', $event)"
          (blur)="onPassBlur('next')"
          aria-label="Nueva contraseña"
        />
        <button
          mat-icon-button
          type="button"
          matSuffix
          (click)="hideNext = !hideNext"
          [attr.aria-label]="hideNext ? 'Mostrar contraseña' : 'Ocultar contraseña'"
          class="!h-7 !w-7"
        >
          <mat-icon class="!text-base">{{ hideNext ? 'visibility' : 'visibility_off' }}</mat-icon>
        </button>
        <mat-hint class="!text-xs text-neutral-500">Mínimo 6 caracteres</mat-hint>
        <mat-error *ngIf="form.get('next')?.hasError('required')">Requerida</mat-error>
        <mat-error *ngIf="form.get('next')?.hasError('minlength')">Mínimo 6 caracteres</mat-error>
      </mat-form-field>

      <div class="text-xs text-gray-600 -mt-2 mb-2 flex items-center gap-2">
        <mat-icon class="!text-base text-orange-500">info</mat-icon>
        Usá al menos 6 caracteres. Evitá datos personales.
      </div>

      <mat-form-field appearance="fill" class="mb-1">
        <mat-label>Confirmar nueva contraseña</mat-label>
        <mat-icon matPrefix class="!text-gray-400 !text-base mr-1">check_circle</mat-icon>
        <input
          matInput
          [type]="hideConfirm ? 'password' : 'text'"
          formControlName="confirm"
          autocomplete="new-password"
          placeholder="Repetí la contraseña"
          (keydown)="onPassKey('confirm', $event)"
          (keyup)="onPassKey('confirm', $event)"
          (blur)="onPassBlur('confirm')"
          aria-label="Confirmar nueva contraseña"
        />
        <button
          mat-icon-button
          type="button"
          matSuffix
          (click)="hideConfirm = !hideConfirm"
          [attr.aria-label]="hideConfirm ? 'Mostrar contraseña' : 'Ocultar contraseña'"
          class="!h-7 !w-7"
        >
          <mat-icon class="!text-base">{{
            hideConfirm ? 'visibility' : 'visibility_off'
          }}</mat-icon>
        </button>
        <mat-error *ngIf="form.get('confirm')?.hasError('required')">Requerido</mat-error>
      </mat-form-field>

      <div
        *ngIf="capsCurrent || capsNext || capsConfirm"
        class="-mt-2 text-xs text-orange-600 flex items-center gap-1"
        aria-live="polite"
      >
        <mat-icon class="!text-base text-orange-500">keyboard_capslock</mat-icon>
        Mayúsculas activadas
      </div>

      <div class="mt-1 flex items-center justify-end gap-2 border-t border-gray-200/70 pt-3">
        <button
          type="button"
          mat-stroked-button
          (click)="close()"
          class="inline-flex items-center gap-1.5 rounded-lg px-3 py-2 text-sm font-medium text-gray-700 border border-gray-300 hover:bg-gray-50 active:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-orange-400/60 focus-visible:ring-offset-1 transition-colors"
        >
          <mat-icon class="!text-base">close</mat-icon>
          Cancelar
        </button>
        <button
          mat-flat-button
          color="primary"
          type="submit"
          [disabled]="loading || form.invalid"
          class="inline-flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-semibold text-white bg-gradient-to-r from-orange-600 to-amber-500 hover:from-orange-700 hover:to-amber-600 disabled:bg-gray-400 disabled:cursor-not-allowed shadow-sm hover:shadow focus:outline-none focus-visible:ring-2 focus-visible:ring-orange-400/70 focus-visible:ring-offset-1 transition-all"
        >
          <mat-icon *ngIf="!loading" class="!text-base">check_circle</mat-icon>
          <mat-icon *ngIf="loading" class="!text-base animate-spin">autorenew</mat-icon>
          {{ loading ? 'Procesando…' : 'Cambiar' }}
        </button>
      </div>

      <div
        *ngIf="error"
        class="mt-2 bg-red-50 border border-red-200 text-red-700 text-sm rounded-xl px-3 py-2"
      >
        {{ error }}
      </div>
      <div
        *ngIf="ok"
        class="mt-2 bg-green-50 border border-green-200 text-green-700 text-sm rounded-xl px-3 py-2"
      >
        ¡Contraseña actualizada!
      </div>
    </form>
  </div>
</mat-card>
