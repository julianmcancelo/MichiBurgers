<div class="max-w-5xl mx-auto px-4 py-4">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-xl font-semibold text-gray-900 flex items-center gap-2">
      <mat-icon class="text-orange-600">monitor_heart</mat-icon>
      Estado de Mesas â€” {{ area | titlecase }}
    </h2>
    <div class="flex gap-2 items-center">
      <button mat-stroked-button color="primary" class="!h-9 !rounded-lg" (click)="actualizarAhora()">
        <mat-icon>refresh</mat-icon>
        <span class="ml-1">Actualizar</span>
      </button>
      <button class="px-3 py-1 rounded-lg border text-sm"
              [class.bg-orange-100]="area==='interior'"
              (click)="cambiarArea('interior')">Interior</button>
      <button class="px-3 py-1 rounded-lg border text-sm"
              [class.bg-orange-100]="area==='exterior'"
              (click)="cambiarArea('exterior')">Exterior</button>
    </div>
  </div>

  <div class="flex items-center gap-2 mb-3 text-sm">
    <button class="px-3 py-1 rounded-full border" [class.bg-gray-100]="filtro==='todas'" (click)="cambiarFiltro('todas')">Todas ({{ listado.length }})</button>
    <button class="px-3 py-1 rounded-full border" [class.bg-green-100]="filtro==='libres'" (click)="cambiarFiltro('libres')">Libres ({{ totalLibres }})</button>
    <button class="px-3 py-1 rounded-full border" [class.bg-red-100]="filtro==='ocupadas'" (click)="cambiarFiltro('ocupadas')">Ocupadas ({{ totalOcupadas }})</button>
  </div>

  <div *ngIf="cargando" class="text-gray-600 text-sm mb-2">Actualizando estado...</div>

  <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
    <div *ngFor="let m of filtradas" class="p-3 rounded-xl border shadow-sm"
         [class.bg-green-50]="m.estado==='libre'"
         [class.bg-red-50]="m.estado==='ocupada'">
      <div class="flex items-center justify-between mb-2">
        <div class="font-semibold text-gray-900">Mesa {{ m.mesaId }}</div>
        <span class="text-xs px-2 py-0.5 rounded-full" [class.bg-green-200]="m.estado==='libre'" [class.bg-red-200]="m.estado==='ocupada'">
          {{ m.estado | titlecase }}
        </span>
      </div>
      <div class="flex gap-2 flex-wrap">
        <ng-container *ngIf="m.estado==='libre'; else accionesOcupada">
          <button mat-flat-button color="primary" class="!h-9 !rounded-lg flex-1" (click)="tomarPedido(m)">
            <mat-icon>add_shopping_cart</mat-icon>
            <span class="ml-1">Tomar pedido</span>
          </button>
        </ng-container>
        <ng-template #accionesOcupada>
          <button mat-stroked-button color="primary" class="!h-9 !rounded-lg flex-1" (click)="irAPedido(m)">
            <mat-icon>visibility</mat-icon>
            <span class="ml-1">Ver</span>
          </button>
          <button mat-stroked-button color="accent" class="!h-9 !rounded-lg" (click)="facturar(m)">
            <mat-icon>receipt_long</mat-icon>
            <span class="ml-1">Facturar / Pagar</span>
          </button>
          <button mat-flat-button color="warn" class="!h-9 !rounded-lg" (click)="liberarMesa(m)">
            <mat-icon>lock_open</mat-icon>
            <span class="ml-1">Liberar</span>
          </button>
        </ng-template>
      </div>
    </div>
  </div>
</div>
