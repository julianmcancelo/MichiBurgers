<!-- Navegación Pedido QR -->
<nav class="sticky top-0 z-30 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 border-b border-secondary-100">
  <div class="container mx-auto px-4 py-3 flex flex-wrap items-center gap-2 text-sm">
    <a [routerLink]="['../']" routerLinkActive="!bg-primary-600 !text-white" [routerLinkActiveOptions]="{ exact: true }"
       class="px-3 py-1.5 rounded-lg font-medium text-primary-700 hover:bg-primary-50 transition">Registro</a>
    <a [routerLink]="['../menu']" routerLinkActive="!bg-primary-600 !text-white"
       class="px-3 py-1.5 rounded-lg font-medium text-primary-700 hover:bg-primary-50 transition">Menú</a>
    <a [routerLink]="['./']" routerLinkActive="!bg-primary-600 !text-white" [routerLinkActiveOptions]="{ exact: true }"
       class="px-3 py-1.5 rounded-lg font-medium text-primary-700 hover:bg-primary-50 transition">Pago</a>
    <a [routerLink]="['../confirmacion']" routerLinkActive="!bg-primary-600 !text-white"
       class="px-3 py-1.5 rounded-lg font-medium text-primary-700 hover:bg-primary-50 transition">Confirmación</a>
    <span class="ms-auto text-secondary-600">Paso 3 de 4</span>
  </div>
</nav>
<div class="w-full min-h-screen bg-gradient-to-br from-secondary-50 to-primary-100 flex items-center justify-center p-4 animate-fade-in">
  <div class="w-full max-w-lg mx-auto">

    <!-- Cabecera -->
    <header class="text-center mb-8">
      <h1 class="font-display text-4xl md:text-5xl font-bold text-secondary-800">Casi listo...</h1>
      <p class="text-secondary-500 mt-1 text-lg">Revisa tu pedido antes de confirmar.</p>
    </header>

    <!-- Panel Principal -->
    <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-lg overflow-hidden">
      <div class="p-6 md:p-8">
        <h2 class="text-xl font-bold text-secondary-800 mb-5">Resumen del Pedido</h2>

        <!-- Lista de Items -->
        <div class="space-y-3 max-h-64 overflow-y-auto pr-2 custom-scrollbar">
          <div *ngFor="let item of pedidoState.items | keyvalue" class="flex justify-between items-center text-secondary-700">
            <div>
              <p class="font-semibold">{{ item.value.nombre }}</p>
              <p class="text-sm text-secondary-500">{{ item.value.cantidad }} x {{ item.value.precio | currency:'$' }}</p>
            </div>
            <p class="font-bold text-secondary-800">{{ (item.value.cantidad * item.value.precio) | currency:'$' }}</p>
          </div>
        </div>

        <!-- Divisor -->
        <div class="border-t-2 border-dashed border-secondary-200 my-5"></div>

        <!-- Total -->
        <div class="flex justify-between items-center mb-6">
          <p class="text-lg font-bold text-secondary-600">Total a pagar:</p>
          <p class="font-display text-4xl font-extrabold text-primary-600">{{ pedidoState.total | currency:'$' }}</p>
        </div>

        <!-- Mensaje de Error -->
        <div *ngIf="errorMessage" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg mb-6 animate-fade-in" role="alert">
          <p class="font-bold">¡Ups! Algo salió mal</p>
          <p>{{ errorMessage }}</p>
        </div>

        <!-- Botón de Acción -->
        <button (click)="confirmarPedido()" [disabled]="isLoading"
                class="w-full bg-primary-600 text-white font-bold py-4 px-6 rounded-xl hover:bg-primary-700 focus:outline-none focus:ring-4 focus:ring-primary-300 disabled:bg-primary-300 disabled:cursor-not-allowed transform hover:-translate-y-1 transition-all duration-300 shadow-lg hover:shadow-primary-400/40 flex items-center justify-center h-16">
          <span *ngIf="!isLoading" class="text-lg">Confirmar y Pagar Ahora</span>
          <div *ngIf="isLoading" class="flex items-center gap-3">
            <svg class="animate-spin h-6 w-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span class="text-lg">Procesando...</span>
          </div>
        </button>
      </div>
    </div>

  </div>
</div>
