<ion-header>
  <ion-toolbar>
    <ion-title>Comandera</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cargar()">
        <ion-icon slot="start" name="refresh-outline"></ion-icon>
        Actualizar
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="cargar($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-segment [(ngModel)]="filtro">
    <ion-segment-button value="todos">Todos</ion-segment-button>
    <ion-segment-button value="pendiente">Pendientes</ion-segment-button>
    <ion-segment-button value="preparando">Preparando</ion-segment-button>
    <ion-segment-button value="listo">Listos</ion-segment-button>
  </ion-segment>

  <div class="spinner" *ngIf="loading">
    <ion-spinner name="dots"></ion-spinner>
  </div>

  <ion-list *ngFor="let p of getPedidosFiltrados()">
    <ion-item lines="full" color="light">
      <ion-label>
        <h2>Pedido #{{ p.pedidoId }} <ion-badge color="tertiary" *ngIf="p.mesa">Mesa {{ p.mesa }}</ion-badge></h2>
        <p>{{ p.mozo }} â€¢ {{ p.hora }}</p>
      </ion-label>
    </ion-item>
    <ng-container *ngFor="let it of p.items">
      <ion-item>
        <ion-label>
          <h3>{{ it.producto }} <ion-badge color="medium">x{{ it.cantidad }}</ion-badge></h3>
          <p *ngIf="it.notas">Notas: {{ it.notas }}</p>
        </ion-label>
        <ion-badge slot="end" [color]="it.estado === 'listo' ? 'success' : (it.estado==='preparando' ? 'warning' : 'danger')">
          {{ it.estado | uppercase }}
        </ion-badge>
        <ion-buttons slot="end">
          <ion-button size="small" color="warning" (click)="actualizar(it.itemId, 'preparando')">
            <ion-icon name="flame-outline"></ion-icon>
          </ion-button>
          <ion-button size="small" color="success" (click)="actualizar(it.itemId, 'listo')">
            <ion-icon name="checkmark-done-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>
    </ng-container>
  </ion-list>
</ion-content>
